data_dir: '/home/jitte/unilogs/vector_data'

sources:
  app_logs:
    type: file
    include:
      - /home/jitte/unilogs/apacheLogger/logs/app.log

# transforms:
#   parse_logs:
#     type: remap
#     inputs:
#       - app_logs
#     source: |
#       # Parse Apache combined with ISO-8601 timestamp
#       parsed, err = parse_apache_log(
#         .message,
#         "combined",
#         "%Y-%m-%dT%H:%M:%S.%fZ"
#       )

#       if err != null {
#         log("Failed to parse log line: " + string!(err), level: "error")
#       } else {
#         . = merge(., parsed)

#         if .path == "/" {
#           .level = "info"
#         } else {
#           .level = split(.path, "/")[1] ?? "unknown"
#         }
#       }

sinks:
  kafka:
    type: kafka
    inputs:
      - app_logs
    bootstrap_servers: 'a384f668f62bb46afa02ab68e0ed166f-e257db0dc24b6af1.elb.eu-north-1.amazonaws.com:9095, a90c2fa84df0d42238f2e139cfd1b56e-f4eaf0072ebaf778.elb.eu-north-1.amazonaws.com:9095, a37f391aabedf422e8e67cf7911cbe4c-4e9984b71dc485db.elb.eu-north-1.amazonaws.com:9095'
    topic: app_logs_topic
    encoding:
      codec: json
    sasl:
      enabled: true
      username: 'vector-user'
      password: 'vector-password' # Ensure this EXACTLY matches the password in CDK/Helm
      mechanism: 'PLAIN'
    tls:
      enabled: true
      ca_file: '/home/jitte/unilogs/apacheLogger/ca.crt'
      verify_hostname: false # <-- ADD THIS TEMPORARILY

  console:
    type: console
    inputs:
      - app_logs
    encoding:
      codec: json
