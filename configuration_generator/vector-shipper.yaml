sources:
  app_logs:
    type: file
    include:
      - /logs/*.log

transforms:
  parse_logs1:
    type: remap
    inputs:
      - app_logs
    file: "./apache-remap.vrl"
  parse_logs2:
    type: remap
    inputs:
      - app_logs
    file: "./apache-remap.vrl"

sinks:
  loki_sink:
    type: loki
    inputs:
      - parse_logs1
      - parse_logs2
    endpoint: https://logs-prod-036.grafana.net
    path: /loki/api/v1/push
    auth:
      strategy: bearer
      token: ${LOKI_TOKEN}
    labels:
      service: footest
    encoding:
      codec: json
  
  console:
    type: console
    inputs:
      - parse_logs1
      - parse_logs2
    encoding:
      codec: logfmt # json